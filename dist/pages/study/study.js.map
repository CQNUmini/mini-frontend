{"version":3,"file":"pages/study/study.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAAA;AAAA;AAeA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;;AAEA;AAAA;AAAA;AAAA;;AAEA;AACA;AAEA;AAFA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAHA;AAAA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AAAA;AAAA;;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AAAA;AAGA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;ACtJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://frontend/._src_pages_study_study.tsx","webpack://frontend/./src/pages/study/study.tsx?eb3c"],"sourcesContent":["import { View, Text, Image } from '@tarojs/components'\r\nimport { useState, useEffect } from 'react'\r\nimport Taro from '@tarojs/taro'\r\n\r\nimport useStore from '@/store/store'\r\nimport useCLasstable from '@/store/classTable'\r\n\r\nimport './study.css'\r\n\r\nimport bookCover from '../../static/reading/cover.png'\r\n\r\ninterface LessonType {\r\n  lesson_id: number\r\n  name: string, // 课程名称\r\n  place: string, // 上课地点\r\n  teacher: string, // 教师\r\n  start_time: number, // 在第几节课开始\r\n  end_time: number, // 在第几节课结束\r\n  day: number, // 星期几\r\n  start_week: number, // 从第几周开始\r\n  end_week: number, // 到第几周结束\r\n  color: string, // 课程颜色\r\n}\r\n\r\nexport default function Study() {\r\n\r\n  const statusBarHeight = useStore(state => state.statusBarHeight)\r\n  const classTable = useCLasstable(state => state.classTable)\r\n  const startDate = useCLasstable(state => state.startDate) // 开学日期\r\n\r\n  const [currentWeek, setCurrentWeek] = useState<number>(1) // 当前周数\r\n\r\n  // 课程时间对照表: [hour, minute]\r\n  const [timeTable, setTimeTable] = useState([\r\n    [8, 30], [9, 25], [10, 30], [11, 25], [14, 30], [15, 25], [16, 30], [17, 25], [19, 30], [20, 25] \r\n  ])\r\n\r\n  const [followingLessons, setFollowingLessons] = useState<LessonType[]>([\r\n    {lesson_id: 1001, name: '今日无课', place: '',  teacher: '', start_time: 1, end_time: 2, day: 0, start_week: 1, end_week: 16, color: '',},\r\n    {lesson_id: 1002, name: '今日无课', place: '',  teacher: '', start_time: 3, end_time: 4, day: 0, start_week: 1, end_week: 16, color: '',},\r\n  ])\r\n\r\n  useEffect(() => {\r\n    const date = new Date();\r\n    // 计算当前周数\r\n    const week = Math.ceil((date.getTime() - new Date(startDate).getTime()) / (1000 * 60 * 60 * 24 * 7))\r\n    setCurrentWeek(week)\r\n\r\n    const day = date.getDay(); // 星期几 \r\n    const hours = date.getHours(); // 几点\r\n    const minutes = date.getMinutes(); // 几分\r\n\r\n    const classTableToday = classTable.filter(item => item.day === day && item.start_week <= currentWeek); // 今日课程  \r\n    \r\n    // 获取今日剩余课程\r\n    if (hours * 60 + minutes < 20 * 60 + 25) {\r\n      const nextStartTime = timeTable.find(item => item[0] * 60 + item[1] > hours * 60 + minutes) as number[];\r\n      const nextStartTimeIndex = timeTable.indexOf(nextStartTime) + 1;\r\n      const followingLessonsToday = classTableToday.filter(item => item.start_time >= nextStartTimeIndex);\r\n  \r\n      // 当只有一节课时\r\n      if (followingLessonsToday.length === 1) {\r\n        setFollowingLessons([\r\n          followingLessonsToday[0],\r\n          {lesson_id: 1002, name: '今日无课', place: '',  teacher: '', start_time: 3, end_time: 4, day: 0, start_week: 1, end_week: 16, color: '',},\r\n        ]);\r\n      } \r\n      // 当没有课时\r\n      else if (followingLessonsToday.length === 0) {\r\n        setFollowingLessons([\r\n          {lesson_id: 1001, name: '今日无课', place: '',  teacher: '', start_time: 1, end_time: 2, day: 0, start_week: 1, end_week: 16, color: '',},\r\n          {lesson_id: 1002, name: '今日无课', place: '',  teacher: '', start_time: 3, end_time: 4, day: 0, start_week: 1, end_week: 16, color: '',},\r\n        ]);\r\n      } else {\r\n        setFollowingLessons(followingLessonsToday);\r\n      }\r\n    } else {\r\n      setFollowingLessons([\r\n        {lesson_id: 1001, name: '今日无课', place: '',  teacher: '', start_time: 1, end_time: 2, day: 0, start_week: 1, end_week: 16, color: '',},\r\n        {lesson_id: 1002, name: '今日无课', place: '',  teacher: '', start_time: 3, end_time: 4, day: 0, start_week: 1, end_week: 16, color: '',},\r\n      ]);\r\n    }\r\n  \r\n  }, [classTable, timeTable, currentWeek]);\r\n\r\n\r\n  return (\r\n    <View className='study-wrapper' style={{ paddingTop: statusBarHeight + 'px' }}>\r\n      <View className='study-header'>专业名称</View>\r\n      <View className='study-content'>\r\n        <View className='study-timetable'>\r\n          <View className='study-timetable-top'>\r\n            <Text>我的课程</Text>\r\n            <View className='study-timetable-toTable' onClick={() => Taro.navigateTo({ url: '/pages/classtable/classtable' })}>查看课表></View>\r\n          </View>\r\n          <View className='study-timetable-items'>\r\n            <View className='study-timetable-current'>\r\n              <View className='study-timetable-left'>\r\n                <Text></Text>\r\n                <Text className='study-timetable-name'>{followingLessons[0].name}</Text>\r\n                <Text>{followingLessons[0].place}</Text>\r\n              </View>\r\n              <View className='study-timetable-line'></View>\r\n              <View className='study-timetable-right'>\r\n                <Text>{timeTable[followingLessons[0].start_time - 1][0] + ':' + timeTable[followingLessons[0].start_time - 1][1]}</Text>\r\n              </View>\r\n            </View>\r\n            <View className='study-timetable-following'>\r\n              <View className='study-timetable-following-wrapper'>\r\n                {\r\n                  followingLessons.map((item, index) => {\r\n                    return (\r\n                      index > 0 &&\r\n                      <View className='study-timetable-item' key={index}>\r\n                        <Text>{item.name}</Text>\r\n                        <Text>{timeTable[item.start_time - 1][0] + ':' + timeTable[item.start_time - 1][1]}</Text>\r\n                      </View>\r\n                    )\r\n                  })\r\n                }\r\n              </View>\r\n            </View>\r\n          </View>\r\n        </View>\r\n        <View className='study-reading'>\r\n          <View className='study-reading-top'>\r\n            <Text>我的阅读</Text>\r\n            <View className='study-reading-toBook'>查看书架></View>\r\n          </View>\r\n          <View className='study-reading-bookShelf'>\r\n            <View className='study-reading-books-xsbd'>\r\n              <Text className='study-reading-books-title'>新生必读</Text>\r\n              <View className='study-reading-books'>\r\n\r\n                <View className='study-reading-book'>\r\n                  <Image src={bookCover} className='study0-reading-book-cover' mode='widthFix'></Image>\r\n                  <View className='study-reading-book-right'>\r\n                    <Text className='study-reading-book-title'>学生手册</Text>\r\n                    <Text className='study-reading-book-description'>学生手册是一种学生手册</Text>\r\n                    <View className='study-reading-book-mark'>强烈推荐</View>\r\n                  </View>\r\n                </View>\r\n\r\n              </View>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </View>\r\n    </View>\r\n  )\r\n}\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./study.tsx\"\nvar config = {};\n\n\nvar inst = Page(createPageConfig(component, 'pages/study/study', {root:{cn:[]}}, config || {}))\n\n\nexport default component\n"],"names":[],"sourceRoot":""}