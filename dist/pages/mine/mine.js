"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[359],{2486:function(e,n,s){var t=s(2180),a=s(4165),i=s(5861),c=s(9439),o=s(1515),r=s(2954),A=s.n(r),m=s(4404),l=s(6657),u=s(1928),g=s(5063),p=s(79),d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIfSURBVHgB3VXtbdswEH2kiiBAI1cblJkgst0C/akN4m7QTtBuEHmCohO4niDuBE4GaK1MYHaCGk4LFAVE9o5kZcnf0b/kAQJF3vHe6fh4Ah47xD6jStIEpRyQ2yWETXkpmApYoWmc6Ptv41YEKukPYOyIXhPAagp4Q94/nNHiwhMKRTO25YeImsE7vU/0WBV3p+oszXb6kU11unPnS3twDMjxKmzIcSTY9ygSFffePTT4BkmcDurrYs1pzgXWy9k5WoBLCiFSSHOuF8WC1yRq2fNAB/sebWHtECwKpzwPWTNfslr0r+IGLRH2alLYFgLhNH5X36Cev04bc7oX6jRVjbXTN6pJY28p2MUmAcC6LqqNXLKonNE4CsGpfHKOEzlzF5DXOt0vOPnLMv24CuMuoNpG0IQwydrKImRYS1a88KP5iUNgBf3PtlpbLweXKGS/0yfuXXs1ejxbZUP9RSCrO+s/hW7Mg/T2+VAMKrWtzrJeoq+cwL7WcAjq7FXGA8n1epMgMhNwnYW4QltIM3JSvy/GGwTu8y24YyZoAe5h8NnnDc7KgQ9PgHv/rTtM/7kPCZ7TM6xn3yBAGWVutHRJWO/STIko3RuYklBxfxqCf9bL7/m6z0pFptSIhA4/kjGMmehlUfgM+x+ofBnZ7kISL+k9o02KJgtI+5ZKPNmWREWgf7tgO7poKejwFRH7HiMM/8XI3wwR0W9zi3yfDv4BenXNfoKcGggAAAAASUVORK5CYII=",x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHiSURBVHgB3VW9TsMwED6nCJCgYCYEk9+AUDGwUZ6AvkE7MvYN2k6MlCdo+wTwBi0zAqUjUz2WiYiChPoT89lNpf45aWBAcJKd2PfdnXP3nUP014WtAhLpTAHQPDGVNRuKtTDXZe+xEWfrxDrfydRwjBpRoJeV8cA7U3UErtFPBM5LGGr8BfM6t2h0O5kyfUcEd0Xo4JrsByhjvALLbRh7ikYpd4wI7Hl2gjpmTiM6Sx6A1ORU0o4hP3SzlzyACqR5Dsm1YoZr7gw2qZj8po+bdv1xHaMT5SMVpeTr+y/EnCLfOOCc7T/7w65JiS4qXz+8AlcvSami3++2bT5iGy2kYcksdIMxUxuBhTavyLenapT9ap0MylLgFODzKLRqg0FV6Xs+/bbEp2jzVNDaUBALxIxCORIp8+XHg5c4gNg+ySLXJQxNQ07R4iN1dzQIKvLTk7EBzL1jLjeF/LIbcNyjAS2eMoXADorNnCywF8AKYAuy50XfsGBNB0Fuo+6XpXboF207v7+sk4VmSWKGMHZvbGMDKNXCnDd1WFFCbD60nY27ADacZ02TU/xc0Ehls7/lupRyclNQDhbthn85YJWkvjqfL7SVpiLt5nRxJwa6LkBPBVB6HwxiHorbkO9ei/6lfAGoA6tfyFjwkQAAAABJRU5ErkJggg==",h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADtSURBVHgB7ZTNEYIwEIU30ZviYAcpIWID0IEdKJ3RgXZgB5gOpARGxyOJm4wip/ypMxz4DgwMm/eyL5kFmBg1LMkObJVd2YJziIRa/0op8JnCjJ5jTYirwAijgfnoZNE8hIAAqKvACFK5AVCt6SThewjAaWBMWtEAVYUxIbQKMXFGNISlnIEkGBdJm1u99lnj1cGbvhMlS/g3uhuWbI9syXNbXVAHQ3GQeLOI2sEcr/EvDXpxfAUFJcZ2stVHHPJA/F5XrjXeBjHiGq+IPuIqDRHXBIwKhaNCBY8Kq8Fr55dYcY09og7yb8QnxsETYudlyg5cF8YAAAAASUVORK5CYII=",f=s.p+"static/mine/login.png",v=s.p+"static/mine/defaultAvatar.png",I=s(6865),N=s(5893);function j(){var e=(0,m.Z)((function(e){return[e,e.setUserInfo]})),n=(0,c.Z)(e,2),s=n[0],t=n[1],j=(0,l.Z)((function(e){return e.requestUrl})),k=(0,u.Z)((function(e){return e.accessKey_id})),w=(0,I.Z)((function(e){return[e,e.setPostData]})),y=(0,c.Z)(w,2),B=y[0],C=y[1];(0,r.useLoad)((0,i.Z)((0,a.Z)().mark((function e(){var n,t;return(0,a.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s.isLogin){e.next=3;break}return A().navigateTo({url:"/pages/login/login"}),e.abrupt("return");case 3:return n=A().getStorageSync("token"),e.next=6,(0,p.$)({method:"GET",url:j,path:"/api/v1/users/communityInfo",header:{Authorization:n}});case 6:t=e.sent,200===t.statusCode?(console.log(t.data),C({myPosts:t.data.data.posts,likesNum:t.data.data.likes})):A().showToast({title:"\u4fe1\u606f\u83b7\u53d6\u5931\u8d25",icon:"error",duration:2e3});case 8:case"end":return e.stop()}}),e)}))));var G=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var n,i,c,o,r,m,l,u,d,x;return(0,a.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A().chooseImage({count:1,sourceType:["album","camera"],sizeType:["compressed"]});case 3:if(n=e.sent,!n.tempFilePaths||!n.tempFilePaths[0]){e.next=33;break}return i=n.tempFilePaths[0],c=A().getStorageSync("token"),o="avatar-".concat(s.id,"-").concat(Date.now()),r=A().getStorageSync("policy"),m=k,l=A().getStorageSync("signature"),A().showLoading({title:"\u4e0a\u4f20\u4e2d",mask:!0}),e.t0=A(),e.next=15,(0,g.Z)(i);case 15:return e.t1=e.sent,e.t2={key:o,policy:r,OSSAccessKeyId:m,signature:l},e.t3={url:"https://cqnu-user-avatars.oss-cn-chengdu.aliyuncs.com",filePath:e.t1,name:"file",formData:e.t2},e.next=20,e.t0.uploadFile.call(e.t0,e.t3);case 20:if(u=e.sent,console.log(u),204!==u.statusCode){e.next=31;break}return d="https://cqnu-user-avatars.oss-cn-chengdu.aliyuncs.com/".concat(o),e.next=26,(0,p.$)({method:"PATCH",url:j,path:"/api/v1/users//updateAvatar",header:{Authorization:c},data:{avatar:d}});case 26:x=e.sent,200===x.statusCode&&(A().setStorageSync("avatar",d),t({avatar:d}),A().showToast({title:"\u4e0a\u4f20\u6210\u529f",icon:"success",duration:2e3})),e.next=32;break;case 31:A().showToast({title:"\u4e0a\u4f20\u5931\u8d25",icon:"error",duration:2e3});case 32:case 33:e.next=39;break;case 36:e.prev=36,e.t4=e["catch"](0),console.log(e.t4);case 39:case"end":return e.stop()}}),e,null,[[0,36]])})));return function(){return e.apply(this,arguments)}}(),S=function(){console.log(s),t({id:"",openid:"",student_id:"",nick_name:"",avatar:"none",user_level:1,user_exp:0,faculty:"",major:"",grade:""}),A().removeStorageSync("token")};return(0,N.jsxs)(o.G7,{className:"mine-wrapper",children:[(0,N.jsxs)(o.G7,{className:"mine-content",children:[(0,N.jsxs)(o.G7,{className:"mine-userInfo",children:[(0,N.jsxs)(o.G7,{className:"mine-basicInfo",children:[(0,N.jsx)(o.Ee,{src:s.isLogin?s.avatar:v,className:"mine-avatar",onClick:G}),(0,N.jsx)(o.xv,{className:"mine-nickname",children:s.isLogin?s.nick_name:"\u8bf7\u767b\u5f55"}),(0,N.jsx)(o.xv,{className:"mine-schoolID",children:s.student_id}),(0,N.jsxs)(o.G7,{className:"mine-moreInfo",children:[(0,N.jsxs)(o.G7,{className:"mine-moreInfo-item",children:["Lv.",s.user_level]}),(0,N.jsx)(o.G7,{className:"mine-moreInfo-item",children:s.grade}),(0,N.jsx)(o.G7,{className:"mine-moreInfo-item",children:s.faculty})]})]}),(0,N.jsxs)(o.G7,{className:"mine-postInfo",children:[(0,N.jsxs)(o.G7,{className:"mine-postInfo-item",onClick:function(){return A().navigateTo({url:"/pages/mine/myPosts/myposts"})},children:[(0,N.jsx)(o.xv,{className:"mine-postInfo-item-num",children:B.myPosts}),(0,N.jsx)(o.xv,{className:"mine-postInfo-item-text",children:"\u53d1\u5e16"})]}),(0,N.jsxs)(o.G7,{className:"mine-postInfo-item",children:[(0,N.jsx)(o.xv,{className:"mine-postInfo-item-num",children:B.likesNum}),(0,N.jsx)(o.xv,{className:"mine-postInfo-item-text",children:"\u6536\u5230\u7684\u8d5e"})]}),(0,N.jsxs)(o.G7,{className:"mine-postInfo-item",children:[(0,N.jsx)(o.xv,{className:"mine-postInfo-item-num",children:"\u672a\u5f00\u901a"}),(0,N.jsx)(o.xv,{className:"mine-postInfo-item-text",children:"\u6700\u8fd1\u6d4f\u89c8"})]})]})]}),s.isLogin?(0,N.jsxs)(o.G7,{className:"mine-functions",children:[(0,N.jsxs)(o.G7,{className:"mine-function mine-contactUs",onClick:function(){A().navigateTo({url:"/pages/mine/contactUs/contactUs"})},children:[(0,N.jsx)(o.Ee,{src:d}),"\u8054\u7cfb\u6211\u4eec"]}),(0,N.jsxs)(o.G7,{className:"mine-function mine-validation",children:[(0,N.jsx)(o.Ee,{src:x}),"\u8eab\u4efd\u8ba4\u8bc1"]}),(0,N.jsxs)(o.G7,{className:"mine-function mine-logout",onClick:S,children:[(0,N.jsx)(o.Ee,{src:h}),"\u9000\u51fa\u767b\u5f55"]})]}):(0,N.jsx)(o.G7,{className:"mine-functions",children:(0,N.jsxs)(o.G7,{className:"mine-function mine-login",onClick:s.toLoginPage,children:[(0,N.jsx)(o.Ee,{src:f}),"\u767b\u5f55"]})})]}),(0,N.jsx)(o.G7,{className:"mine-topBackground"})]})}var k={};Page((0,t.createPageConfig)(j,"pages/mine/mine",{root:{cn:[]}},k||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[107,216,592],(function(){return n(2486)}));e.O()}]);